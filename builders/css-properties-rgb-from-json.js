const chroma = require('chroma-js')
const toKebabCase = require('lodash/kebabCase')

const PALETTE = require('../dist/colors.meta.json')

const colors = PALETTE.colors.map(colorArray => {
  return orderByVariableEntry(colorArray).map(formatVariableEntry)
})

printStylesheet(colors)

function orderByVariableEntry(colorArray) {
  const source = colorArray.filter(colorObject => !colorObject._meta.alias)
  const aliases = colorArray.filter(colorObject => colorObject._meta.alias)

  return source.concat(aliases)
}

function formatVariableEntry(colorObject) {
  return `${formatVariableName(colorObject)}: ${formatVariableValue(colorObject)};`
}

function formatVariableName(colorObject) {
  return `--studio-${toKebabCase(colorObject.name.toLowerCase())}-rgb`
}

function formatVariableValue(colorObject) {
  return formatRGB(colorObject.value)
}

function formatRGB(colorValue) {
  const chromaObject = chroma(colorValue)
  return ['r', 'g', 'b'].map(c => chromaObject.get(`rgb.${c}`)).join(', ')
}

function printStylesheet(colorArrays) {
  const blocks = colorArrays.map(colorArray => {
    return colorArray.map(entry => `  ${entry}`).join('\n')
  })

  const contents = [
    `/* Generated by Color Studio v${PALETTE.version} */`,
    '\n\n',
    ':root {',
    '\n',
    blocks.join('\n\n'),
    '\n',
    '}'
  ]

  console.log(contents.join(''))
}
